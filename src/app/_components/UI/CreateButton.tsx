"use client";

import Link from "next/link";
import { type MutableRefObject, useEffect, useRef, useState } from "react";

const CreateButton = () => {
  const [isTabOpen, setIsTabOpen] = useState(false);
  const tabRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (!isTabOpen) return;

    const closeTab = () => {
      setIsTabOpen(false);
    };

    document.addEventListener("click", closeTab);

    return () => {
      document.removeEventListener("click", closeTab);
    };
  }, [isTabOpen]);

  return (
    <div className="rounded border border-slate-900 transition hover:border-slate-500 hover:bg-gray-100 active:bg-gray-200">
      <button
        onClick={() => setIsTabOpen((prev) => !prev)}
        className="flex h-full items-center gap-0.5 px-1"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          strokeWidth="1.5"
          stroke="currentColor"
          data-slot="icon"
          className="h-5 w-5"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="M12 4.5v15m7.5-7.5h-15"
          />
        </svg>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          strokeWidth="1.5"
          stroke="currentColor"
          data-slot="icon"
          className="h-4 w-4"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            d="m19.5 8.25-7.5 7.5-7.5-7.5"
          />
        </svg>
      </button>
      {isTabOpen && (
        <div ref={tabRef} className="relative">
          <div className="absolute right-0 top-2 z-10 flex h-fit w-36 flex-col whitespace-nowrap rounded-lg border bg-white p-2 shadow-lg">
            <div className="cursor-pointer rounded-md px-2 py-2 hover:bg-gray-200">
              <div className="flex items-center gap-1.5">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  className="h-4 w-4"
                >
                  <path
                    d="M22.1538 4.76923H12.3077L9.10767 2.36925C8.78774 2.1303 8.39933 2.00082 8.00002 2H1.84615C1.3567 2.00056 0.887444 2.19524 0.541344 2.54134C0.195245 2.88744 0.000559775 3.3567 0 3.84615V19.5385C0.000559775 20.0279 0.195245 20.4972 0.541344 20.8433C0.887444 21.1894 1.3567 21.3841 1.84615 21.3846H22.2564C22.7187 21.3841 23.1619 21.2002 23.4887 20.8733C23.8156 20.5465 23.9995 20.1033 24 19.641V6.61538C23.9994 6.12593 23.8048 5.65667 23.4587 5.31058C23.1126 4.96448 22.6433 4.76979 22.1538 4.76923ZM22.1538 19.5385H1.84615V3.84615H8.00002L11.2 6.24613C11.5199 6.48508 11.9084 6.61457 12.3077 6.61538L22.1538 6.6142L22.1538 6.61538V19.5385ZM15.6923 13.0769C15.6923 13.1981 15.6684 13.3182 15.622 13.4302C15.5757 13.5422 15.5077 13.6439 15.422 13.7296C15.3362 13.8154 15.2345 13.8834 15.1225 13.9297C15.0105 13.9761 14.8905 14 14.7692 14H12.9231V15.8462C12.9231 16.091 12.8258 16.3258 12.6527 16.4989C12.4796 16.672 12.2448 16.7692 12 16.7692C11.7552 16.7692 11.5204 16.672 11.3473 16.4989C11.1742 16.3258 11.0769 16.091 11.0769 15.8462V14H9.23077C8.98595 14 8.75117 13.9027 8.57806 13.7296C8.40494 13.5565 8.30769 13.3217 8.30769 13.0769C8.30769 12.8321 8.40494 12.5973 8.57806 12.4242C8.75117 12.2511 8.98595 12.1538 9.23077 12.1538H11.0769V10.3077C11.0769 10.0629 11.1742 9.82809 11.3473 9.65498C11.5204 9.48187 11.7552 9.38462 12 9.38462C12.2448 9.38462 12.4796 9.48187 12.6527 9.65498C12.8258 9.82809 12.9231 10.0629 12.9231 10.3077V12.1538H14.7692C14.8905 12.1538 15.0105 12.1777 15.1225 12.2241C15.2345 12.2705 15.3362 12.3385 15.422 12.4242C15.5077 12.5099 15.5757 12.6117 15.622 12.7237C15.6684 12.8357 15.6923 12.9557 15.6923 13.0769Z"
                    fill="black"
                  />
                </svg>

                <span>New alarmlist</span>
              </div>
            </div>
            <Link
              className="flex items-center gap-1.5 rounded-md px-2 py-2 hover:bg-gray-200"
              href="/create"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className="h-4 w-4"
              >
                <g clipPath="url(#clip0_0_1)">
                  <path
                    d="M11.9999 1.57384H11.9845C6.23479 1.57384 1.57369 6.23493 1.57369 11.9847C1.57369 14.7636 2.66244 17.2882 4.43666 19.1552L4.43248 19.1507L1.79419 22.3955C1.65678 22.5633 1.57349 22.7801 1.57349 23.0164C1.57349 23.5597 2.0139 24.0001 2.55724 24.0001C2.86428 24.0001 3.13848 23.8595 3.3189 23.639L3.32027 23.6373L5.91354 20.4479C7.59796 21.6842 9.71214 22.4262 11.9996 22.4262C14.301 22.4262 16.4269 21.6752 18.1457 20.4047L18.1175 20.4247L20.674 23.6296C20.8557 23.8542 21.1313 23.9966 21.4401 23.9966C21.983 23.9966 22.4232 23.5565 22.4232 23.0135C22.4232 22.782 22.3432 22.5692 22.2093 22.4012L22.2109 22.4032L19.5935 19.122C21.3478 17.263 22.4261 14.7494 22.4261 11.9841C22.4261 6.23469 17.7652 1.57389 12.0158 1.57389H11.999H11.9998L11.9999 1.57384ZM3.5409 12C3.5409 7.32826 7.32811 3.54104 11.9999 3.54104C16.6716 3.54104 20.4589 7.32826 20.4589 12C20.4589 16.6718 16.6716 20.459 11.9999 20.459C7.33027 20.4536 3.54626 16.6696 3.5409 12.0005V12ZM2.20457 6.39585H2.20556C2.74875 6.39585 3.18916 5.95544 3.18916 5.41225C3.18916 5.04315 2.9859 4.72161 2.68521 4.55332L2.68024 4.55076C2.2523 4.31155 1.9677 3.86125 1.9677 3.34454C1.9677 2.5839 2.58429 1.96725 3.34494 1.96725C3.86192 1.96725 4.31231 2.25211 4.54788 2.67338L4.55147 2.68037C4.72242 2.98533 5.04359 3.18805 5.41212 3.18805C5.95522 3.18805 6.39548 2.74779 6.39548 2.2047C6.39548 2.03011 6.34999 1.86619 6.27022 1.72408L6.27278 1.72905C5.69171 0.690538 4.59869 0 3.34435 0C1.49731 0 0 1.49734 0 3.34437C0 4.59928 0.691178 5.69277 1.71361 6.26493L1.7305 6.27361C1.86715 6.35053 2.0305 6.39583 2.20435 6.39583H2.2046L2.20457 6.39585ZM20.6556 7.37766e-05H20.6552C19.401 7.37766e-05 18.3082 0.690956 17.7365 1.71292L17.7279 1.72984C17.6497 1.86764 17.6036 2.03254 17.6036 2.20819C17.6036 2.75109 18.0437 3.19118 18.5866 3.19118C18.9566 3.19118 19.2789 2.98673 19.4466 2.68462L19.4491 2.67963C19.6884 2.25166 20.1386 1.96708 20.6554 1.96708C21.416 1.96708 22.0326 2.58368 22.0326 3.34432C22.0326 3.8613 21.7478 4.3117 21.3265 4.54727L21.3196 4.55086C21.014 4.72176 20.8108 5.04327 20.8108 5.41225C20.8108 5.95554 21.2512 6.39592 21.7945 6.39592C21.9687 6.39592 22.1324 6.35058 22.2743 6.27111L22.2694 6.27366C23.3088 5.69285 24 4.59933 24 3.3444C23.9999 1.49736 22.5026 7.37766e-05 20.6556 7.37766e-05ZM16.7212 11.0164H12.9835V7.27873C12.9835 6.73554 12.5431 6.29513 11.9999 6.29513C11.4567 6.29513 11.0163 6.73554 11.0163 7.27873V11.0164H7.27858C6.73539 11.0164 6.29498 11.4568 6.29498 12C6.29498 12.5432 6.73539 12.9836 7.27858 12.9836H11.0163V16.7213C11.0163 17.2645 11.4567 17.7049 11.9999 17.7049C12.5431 17.7049 12.9835 17.2645 12.9835 16.7213V12.9836H16.7212C17.2644 12.9836 17.7048 12.5432 17.7048 12C17.7048 11.4568 17.2644 11.0164 16.7212 11.0164Z"
                    fill="black"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_0_1">
                    <rect width="24" height="24" fill="white" />
                  </clipPath>
                </defs>
              </svg>

              <span>New alarm</span>
            </Link>
          </div>
        </div>
      )}
    </div>
  );
};

export default CreateButton;
